<!DOCTYPE html>
<!--[if lt IE 9 ]><html class="no-js oldie" lang="en"> <![endif]-->
<!--[if IE 9 ]><html class="no-js oldie ie9" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->

<head>
        <!--- basic page needs
    ================================================== -->
    <meta charset="utf-8">
    <!--
    <meta name="description" content="">
    <meta name="author" content="">
    -->
    <!-- mobile specific metas
    ================================================== -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- CSS
    ================================================== -->
    <link rel="stylesheet" href="https://minglunwu.com/theme/css/base.css">
    <!--<link rel="stylesheet" href="https://minglunwu.com/theme/css/vendor.css">-->
    <link rel="stylesheet" href="https://minglunwu.com/theme/css/main.css">
    <link rel="stylesheet" href="https://minglunwu.com/theme/css/styles.css">

    <!-- script
    ================================================== -->
    <script src="https://minglunwu.com/theme/js/modernizr.js"></script>
    <script src="https://minglunwu.com/theme/js/pace.min.js"></script>
    <!--<script src="https://kit.fontawesome.com/968a4ded4c.js" crossorigin="anonymous"></script>-->

    <!-- favicons
    ================================================== -->
    <link rel="shortcut icon" href="https://minglunwu.com/theme/favicon.ico" type="image/x-icon">
    <link rel="icon" href="https://minglunwu.com/theme/favicon.ico" type="image/x-icon">

    <title>Ansible 入門筆記(二) - Variable</title>
    <meta property="og:title" content="Ansible 入門筆記(二) - Variable">
    <meta name="description" content="<p>Ansible透過 Group Variable 及 Host Variable 更靈活的設定多台機器。</p>">
    <meta property="og:description" content="<p>Ansible透過 Group Variable 及 Host Variable 更靈活的設定多台機器。</p>">
    <meta name="author" content="MingLun Allen Wu">
    <meta property="og:image" content="https://images.unsplash.com/photo-1468276311594-df7cb65d8df6?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&ixlib=rb-1.2.1&auto=format&fit=crop&w=2070&q=80">
    
    <link rel="image_src" type="image/jpeg" href="https://images.unsplash.com/photo-1468276311594-df7cb65d8df6?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&ixlib=rb-1.2.1&auto=format&fit=crop&w=2070&q=80" />
    <style>
        img{
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
    </style>
</head>

<body id="top">
            <!-- header
    ================================================== -->
    <header class="s-header">

        <div class="header-logo">
            <a class="site-logo" href="https://minglunwu.com"><img src="https://minglunwu.com/theme/images/logo.png" width="160" height="56" alt="Homepage"></a>
        </div>

        <nav class="header-nav-wrap">
            <ul class="header-nav">
                <li class="current"><a href="https://minglunwu.com/#home" title="home">Home</a></li>
                <li><a href="https://minglunwu.com/#about" title="about">About</a></li>
                <li><a href="https://minglunwu.com/#blog" title="blog">Blogs</a></li>
                <li><a href="https://minglunwu.com/#note" title="note">Notes</a></li>
                <!--<li><a class="smoothscroll" href="#note" title="notes">Notes</a></li>-->
                <!--<li><a class="smoothscroll"  href="#contact" title="contact">Contact</a></li>-->
            </ul>
        </nav>

        <a class="header-menu-toggle" href="#0"><span>Menu</span></a>

    </header> <!-- end s-header -->

        <article class="blog-single">

            <!-- page header/blog hero
            ================================================== -->
            <div class="page-header page-header--single page-hero" style="background-image:url(https://images.unsplash.com/photo-1468276311594-df7cb65d8df6?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&ixlib=rb-1.2.1&auto=format&fit=crop&w=2070&q=80)">
            
                <div class="row page-header__content narrow">
                    <article class="col-full">
                        <div class="page-header__info">
                            <div class="page-header__cat">
                                    <a href="#0">Python</a>
                                    <a href="#0">Ansible</a>
                            </div>
                        </div>
                        <h1 class="page-header__title">
                            <a href="#0" title="">
                                Ansible 入門筆記(二) - Variable
                            </a>
                        </h1>
                        <ul class="page-header__meta">
                            <li class="date">2021-Oct-08 (Fri)</li>
                            <li class="author">
                                By
                                <span>MingLun Allen Wu</span>
                            </li>
                            <li> views</li>
                        </ul>
                        
                    </article>
                </div>
        
            </div> <!-- end page-header -->
    
            <div class="row blog-content">
                <div class="col-full blog-content__main">
                    
                    <h1>TL;DR</h1>
<p>前情提要 - <a href="https://minglunwu.github.io/notes/2021/ansible_note.html">Ansible 入門筆記(ㄧ) - 核心概念及架構</a></p>
<p>使用 <code>Ansible</code> 同時部署多台機器時，使用<code>Variable</code>機制可以根據需求，賦予不同群組、不同節點特定的參數，增加部署的彈性及效率。</p>
<h1>Jinja2 渲染</h1>
<p>在開始探討 <code>Ansible</code> 的 Variable 前，我們先花點篇幅介紹 <code>Jinja2</code> 的渲染機制。</p>
<p><a href="https://jinja.palletsprojects.com/en/3.0.x/">Jinja2</a>是Python一套相當強大的模板引擎，許多Python相關的套件都有支援，例如: <code>Flask</code>, <code>FastAPI</code>。</p>
<p>場內連結: 對於<code>Flask</code>, <code>FastAPI</code> 有興趣的朋友，歡迎看看我的其他筆記:</p>
<ul>
<li><a href="https://minglunwu.github.io/notes/2021/fast_api_note_1.html">FastAPI 入門筆記(一) - 基本介紹</a></li>
<li><a href="https://minglunwu.github.io/notes/2021/flask_plus_wsgi.html">Flask想上線? 你還需要一些酷東西</a></li>
</ul>
<p>你可以將 <code>Jinja2</code> 的功能理解為:</p>
<blockquote>
<p>根據需求將資訊動態寫入到檔案中</p>
</blockquote>
<p>舉例來說，身為一個網頁設計師，你接到了一個案子，需要替公辰麵館設計一個網頁如下:</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span> 歡迎蒞臨-公辰麵館 <span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>公辰麵館讚啦!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>


<p>因為網頁寫的太棒了，隔壁的華貞生魚片也希望你替他們設計一個相同的網頁，於是你又動手開工:</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span> 歡迎蒞臨-華貞生魚片 <span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>華貞生魚片讚啦!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>


<p>仔細一看，這兩個網頁的架構幾乎一模一樣 (真是沒有職業道德的網頁設計師)，只有店名的地方不一樣，如果能夠更省點時間有多好？ </p>
<p>這時候 <code>Jinja2</code> 就派上用場了，你可以設計一個 <strong>模板(Template)</strong>，裡面包含了重複的資訊，並且把要替換的資訊<strong>挖空</strong>:</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span> 歡迎蒞臨-{{ customer }} <span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>{{ customer }}讚啦!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>


<p>這時候只要提供 <code>customer</code> 這個變數， <code>Jinja2</code> 就會按照上面的模板，自動將<code>customer</code>變數填進去，也就是說你只需要提供不同的 <code>customer</code> ，就可以快速的產生數百間店面的網頁！</p>
<blockquote>
<p>真是薛翻了！</p>
</blockquote>
<hr>
<h1>Variable</h1>
<p>在 <code>Ansible</code> 的專案資料夾中有兩種類型的 Variable: <code>Host Variable</code> 以及 <code>Group Variable</code>。</p>
<h2>專案架構</h2>
<p><code>Ansible</code> 透過這兩種變數的交互使用，「快速」且「彈性」管理多台機器，先來個案例：</p>
<p>假設你準備要部署服務，而你的環境如下圖:</p>
<p><img style="display:block; margin-left:auto; margin-right:auto; width:100%;" src="https://minglunwu.github.io/images/20211008/architecture.png"></p>
<p>從上圖中，由外而內: </p>
<ol>
<li>有兩個獨立的環境(<em>Environment</em>): <code>SIT</code> 和 <code>PROD</code></li>
<li>
<p>每個環境中按照功能導向可分為兩種群組(<em>Group</em>):</p>
<ul>
<li><code>Web-Server</code></li>
<li><code>DB-Server</code></li>
</ul>
</li>
<li>
<p>每個群組中依照需求又可有多台主機(<em>Node</em>)</p>
</li>
</ol>
<h2>設定 Inventory File - 區別環境</h2>
<p>上圖的架構在 <code>Ansible</code> 的架構中該如何表達呢？ </p>
<p>首先需要掌握幾個重點:</p>
<ul>
<li>一個環境會有一個<code>Inventory File</code></li>
<li><code>Inventory File</code> 中定義了<strong>節點的連線資訊</strong> 和 <strong>節點隸屬的群組</strong></li>
</ul>
<p>理解上述重點後，我們可以產生下列的<code>Inventory File</code>: </p>
<p>第一個 <code>Inventory File</code> - <strong>SIT</strong></p>
<div class="highlight"><pre><span></span><span class="c1"># SIT</span>
<span class="p p-Indicator">[</span><span class="nv">Web_Server</span><span class="p p-Indicator">]</span> <span class="c1"># 定義群組</span>
<span class="l l-Scalar l-Scalar-Plain">Node_A ansible_host=127.0.0.1 ansible_port=44</span>
<span class="l l-Scalar l-Scalar-Plain">Node_B ansible_host=192.168.16.49 ansible_port=44</span>

<span class="l l-Scalar l-Scalar-Plain">[DB_Server]</span> <span class="c1"># 定義群組</span>
<span class="l l-Scalar l-Scalar-Plain">Node_C ansible_host=127.0.0.1 ansible_port=3306</span>
<span class="l l-Scalar l-Scalar-Plain">Node_D ansible_host=192.168.16.49 ansible_port=3306</span>
</pre></div>


<p>第二個 <code>Inventory File</code> - <strong>Production</strong></p>
<div class="highlight"><pre><span></span><span class="c1"># Production</span>
<span class="p p-Indicator">[</span><span class="nv">Web_Server</span><span class="p p-Indicator">]</span> <span class="c1"># 定義群組</span>
<span class="l l-Scalar l-Scalar-Plain">Node_E ansible_host=192.168.16.6 ansible_port=44</span>
<span class="l l-Scalar l-Scalar-Plain">Node_F ansible_host=192.168.16.22 ansible_port=44</span>

<span class="l l-Scalar l-Scalar-Plain">[DB_Server]</span> <span class="c1"># 定義群組</span>
<span class="l l-Scalar l-Scalar-Plain">Node_H ansible_host=192.168.17.12 ansible_port=3306</span>
<span class="l l-Scalar l-Scalar-Plain">Node_G ansible_host=192.168.17.84 ansible_port=3306</span>
</pre></div>


<blockquote>
<p>一個環境會有一個Inventory File，其定義了節點的連線資訊及各節點隸屬的群組</p>
</blockquote>
<p>此時專案資料夾將會長這樣:</p>
<div class="highlight"><pre><span></span>ansible_project
<span class="p">|</span> - README.md
<span class="p">|</span> - SIT  <span class="c1"># Inventory File</span>
<span class="p">|</span> - Production <span class="c1"># Inventory File</span>
<span class="p">|</span> - main.yml <span class="c1"># Playbook</span>
</pre></div>


<p>定義好 <code>Inventory File</code> 後，透過指定 <code>Inventory File</code> 就可以對不同的環境進行操作:</p>
<div class="highlight"><pre><span></span>ansible-playbook -i SIT main.yml <span class="c1"># 操作SIT環境</span>
ansible-playbook -i Production main.yml <span class="c1"># 操作Production環境</span>
</pre></div>


<h2>Group Variable - 群組變數</h2>
<p>在開頭我們提到使用 <code>Variable</code> 可以有彈性的操作多台機器，又介紹了 <code>Jinja2</code> 這種語法，現在我們來揭曉原因！</p>
<p>在 <code>Playbook</code> 中可以使用 <code>Jinja2</code>語法，舉個例子，我們設計一個簡單的 <code>Playbook</code>，在執行時會透過 Debug 模組印出特定的值.</p>
<div class="highlight"><pre><span></span><span class="c1"># main.yml</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">task-for-db</span>
  <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DB_Server</span>
  <span class="nt">tasks</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">db-show-group</span>
      <span class="nt">debug</span><span class="p">:</span>
        <span class="nt">msg</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">I&#39;m a database node! My group is {{ group_value }}</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">task-for-web</span>
  <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Web_Server</span>
  <span class="nt">tasks</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">web-show-group</span>
      <span class="nt">debug</span><span class="p">:</span>
        <span class="nt">msg</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">I&#39;m a web node! My group is {{ group_value }}</span>
</pre></div>


<p>接下來可以在 <code>group_vars</code> 資料夾下，根據<strong>群組名稱建立同名的 yaml 檔案</strong>:</p>
<div class="highlight"><pre><span></span><span class="c1"># group_vars/Web_Server.yml</span>
<span class="nt">group_value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">GROUP_WEB</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># group_vars/DB_Server.yml</span>
<span class="nt">group_value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">GROUP_DB</span>
</pre></div>


<p>當 <code>Playbook</code> 被執行時， <code>Ansible</code> 會造訪 <code>group_vars</code> 資料夾讀取這些變數: </p>
<ul>
<li><code>Playbook</code> 中 <code>hosts</code> 設定為 <code>Web_Server</code> 的區塊，有個 <code>{{ group_value }}</code>，<code>Ansible</code> 將自動從 <code>group_vars/Web_Server.yml</code>中將設定的變數填入.</li>
<li><code>Playbook</code> 中 <code>hosts</code> 設定為 <code>DB_Server</code> 的區塊，有個 <code>{{ group_value }}</code>，<code>Ansible</code> 將自動從 <code>group_vars/DB_Server.yml</code>中將設定的變數填入.</li>
</ul>
<blockquote>
<p>當群組有自己專用的變數時，可以設定在<code>group_vars</code>中，例如DB_Server會需要資料庫的名稱、連線資訊，而 Web_Server 則不需要。</p>
</blockquote>
<p>此時我們將前面的專案結構稍微擴充 : </p>
<div class="highlight"><pre><span></span>ansible_project
<span class="p">|</span> - README.md
<span class="p">|</span> - SIT  <span class="c1"># Inventory File</span>
<span class="p">|</span> - Production <span class="c1"># Inventory File</span>
<span class="p">|</span> main.yml <span class="c1"># Playbook</span>
<span class="p">|</span> 
<span class="p">|</span> - group_vars/ 
    <span class="p">|</span> - DB_Server.yml <span class="c1"># Group Variable</span>
    <span class="p">|</span> - Web_Server.yml <span class="c1"># Group Variable</span>
</pre></div>


<h2>Host Variable - 節點變數</h2>
<blockquote>
<p>Host Variable 放置的是節點專屬的變數</p>
</blockquote>
<p>有別於 <code>Group Value</code> 放置的是群組專用的變數，有時候我們會需要設定「節點」專屬的變數 (例如節點的ip、Linux的版本等等)。</p>
<p>舉例來說，我們稍微擴充一下 <code>Playbook</code>:</p>
<div class="highlight"><pre><span></span><span class="c1"># main.yml</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">task-for-db</span>
  <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DB_Server</span>
  <span class="nt">tasks</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">db-show-group</span>
      <span class="nt">debug</span><span class="p">:</span>
        <span class="nt">msg</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">I&#39;m a database node! My group is {{ group_value }}</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">db-show-node</span>
      <span class="nt">debug</span><span class="p">:</span>
        <span class="nt">msg</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">My node information(DB) is {{ node_value }}</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">task-for-web</span>
  <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Web_Server</span>
  <span class="nt">tasks</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">web-show-group</span>
      <span class="nt">debug</span><span class="p">:</span>
        <span class="nt">msg</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">I&#39;m a web node! My group is {{ group_value }}</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">web-show-node</span>
      <span class="nt">debug</span><span class="p">:</span>
        <span class="nt">msg</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">My node information(Web) is {{ node_value }}</span>
</pre></div>


<p>這些節點專屬的變數統一放在 <code>host_vars/</code> 資料夾下，且<strong>名稱會與節點同名</strong></p>
<div class="highlight"><pre><span></span><span class="c1"># /host_vars/Node_A.yml</span>
<span class="n">node_value</span><span class="p">:</span> <span class="n">I</span><span class="s1">&#39;m Node A</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># /host_vars/Node_B.yml</span>
<span class="n">node_value</span><span class="p">:</span> <span class="n">I</span><span class="s1">&#39;m Node B</span>
</pre></div>


<p>當 <code>Playbook</code> 被執行時， <code>Ansible</code> 會造訪 <code>host_vars</code> 資料夾讀取這些變數: </p>
<ul>
<li><code>Ansible</code>在<code>Node_A</code>機器上執行<code>Playbook</code>安排的任務時，將自動從 <code>host_vars/Node_A.yml</code>中將設定的變數填入<code>{{ node_value }}</code>.</li>
<li>
<ul>
<li><code>Ansible</code>在<code>Node_B</code>機器上執行<code>Playbook</code>安排的任務時，將自動從 <code>host_vars/Node_B.yml</code>中將設定的變數填入<code>{{ node_value }}</code>.</li>
</ul>
</li>
</ul>
<blockquote>
<p>當節點有自己專用的變數時，可以設定在 <code>host_vars/</code> 中，例如節點A與節點B分別有不同的IP位置。</p>
</blockquote>
<p>此時我們繼續擴充專案結構 : </p>
<div class="highlight"><pre><span></span><span class="n">ansible_project</span>
<span class="o">|</span> <span class="o">-</span> <span class="n">README</span><span class="o">.</span><span class="n">md</span>
<span class="o">|</span> <span class="o">-</span> <span class="n">SIT</span>  <span class="c1"># Inventory File</span>
<span class="o">|</span> <span class="o">-</span> <span class="n">Production</span> <span class="c1"># Inventory File</span>
<span class="o">|</span> <span class="n">main</span><span class="o">.</span><span class="n">yml</span> <span class="c1"># Playbook</span>
<span class="o">|</span>
<span class="o">|</span> <span class="o">-</span> <span class="n">group_vars</span><span class="o">/</span>
    <span class="o">|</span> <span class="o">-</span> <span class="n">DB_Server</span><span class="o">.</span><span class="n">yml</span> <span class="c1"># Group Variable</span>
    <span class="o">|</span> <span class="o">-</span> <span class="n">Web_Server</span><span class="o">.</span><span class="n">yml</span> <span class="c1"># Group Variable</span>
<span class="o">|</span> <span class="o">-</span> <span class="n">host_vars</span><span class="o">/</span>
    <span class="o">|</span> <span class="o">-</span> <span class="n">Node_A</span><span class="o">.</span><span class="n">yml</span> <span class="c1"># Host Variable</span>
    <span class="o">|</span> <span class="o">-</span> <span class="n">Node_B</span><span class="o">.</span><span class="n">yml</span> <span class="c1"># Host Variable</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">|</span> <span class="o">-</span> <span class="n">Node_H</span><span class="o">.</span><span class="n">yml</span> <span class="c1"># Host Variable</span>
</pre></div>


<h1>結論</h1>
<p>本篇筆記記錄了 <code>Ansible</code> 容易搞混的 <code>Variable</code> 機制，根據部署時的需求可以選擇使用 <code>Group Variable</code> 或是 <code>Host Variable</code>.</p>
<p>這些<code>Variable</code>都會在<code>Playbook</code>執行時透過<code>Jinja2</code>的渲染將變數填入。</p>
<p>在多台機器上部署服務時，通常做的事情都是相同的，只是使用的參數會有所不同，透過 <code>Group Variable</code> 和 <code>Host Variable</code> 的交叉使用，可以靈活設定每一個節點。 </p>
<p>一旦某些參數需要進行調整(例如<code>Production</code>環境的某個IP要更換)，可以直接更換<code>Variable</code>設定的值就好，不需要勞師動眾的調整<code>Playbook</code>。</p>
<p>在下篇筆記中，我們將會繼續介紹 <code>Ansible</code> 的應用，包含:</p>
<ul>
<li>如何使用 <code>role</code> 來提高 <code>Ansible</code> 專案的程式碼重用率</li>
<li>使用 <code>Ansible-Galaxy</code> 來取得眾多開源<code>Playbook</code></li>
</ul>
<p>感謝您的閱讀！如果有任何問題歡迎透過<a href="mailto:allen6997535@gmail.com">電子郵件</a>聯繫我！</p>
<p>我們下次見！</p>
    
                    <p class="blog-content__tags">
                        <span>Post Tags</span>
    
                        <span class="blog-content__tag-list">
                             <a href="#0">Python</a>
                             <a href="#0">Ansible</a>
                        </span>
    
                    </p>
    
                    <div class="blog-content__pagenav">
                        <div class="blog-content__nav">










































                            <div class="blog-content__prev">
                                <a href="https://minglunwu.com/notes/2021/data_quality.html" rel="prev">
                                    <span>Previous Post</span>
                                    監控資料品質的旅程
                                </a>
                            </div>
                            <div class="blog-content__next">
                                <a href="https://minglunwu.com/notes/2021/ansible_note.html" rel="next">
                                    <span>Next Post</span>
                                    Ansible 入門筆記(ㄧ) - 核心概念及架構
                                </a>
                            </div>
                        </div>
    
                        <div class="blog-content__all">
                            <a href="https://minglunwu.com/archives.html" class="btn btn--primary">
                                View All Post
                            </a>
                        </div>
                    </div>
    
                </div><!-- end blog-content__main -->
            </div> <!-- end blog-content -->
    
        </article>
        <script src="https://utteranc.es/client.js"
                repo="MingLunWu/MingLunWu.github.io"
                issue-term="pathname"
                theme="github-dark-orange"
                crossorigin="anonymous"
                async>
        </script>
        <!-- Comment Box 留言系統 - 需要調整位置 -->
        <!-- <div class="commentbox"></div>
        <script src="https://unpkg.com/commentbox.io/dist/commentBox.min.js"></script>
        <script>commentBox('5640802722119680-proj')</script> -->
            <!-- footer
    ================================================== -->
    <footer>
        <div class="row">
            <div class="col-full">

                <div class="footer-logo">
                    <a class="footer-site-logo" href="#0"><img src="https://minglunwu.com/theme/images/logo.png" alt="Homepage"></a>
                </div>
                <ul class="footer-social">
                    <li>
                        <a href="https://www.facebook.com/zebra52000" target="_blank"><i class="im im-facebook" aria-hidden="true"></i><span>Facebook</span></a>
                    </li>
                    <li>
                        <a href="https://minglun-wu.medium.com" target="_blank"><i class="im im-book" aria-hidden="true"></i><span>Medium</span></a>
                    </li>
                    <li>
                        <a href="https://github.com/MingLunWu" target="_blank"><i class="im im-github" aria-hidden="true"></i><span>Github</span></a>
                    </li>
                    <li>
                        <a href="https://www.linkedin.com/in/%E6%98%8E%E5%80%AB-%E5%90%B3-637020142/" target="_blank"><i class="im im-linkedin" aria-hidden="true"></i><span>LinkedIn</span></a>
                    </li>
                    <li>
                        <a href="https://www.instagram.com/fade_relish/" target="_blank"><i class="im im-instagram" aria-hidden="true"></i><span>Instagram</span></a>
                    </li>
                </ul>
                    
            </div>
        </div>

        <div class="row footer-bottom">

            <div class="col-twelve">
                <div class="copyright">
                    <span>© Copyright MingLunWu 2021</span> 
                    <span>Design by <a href="https://www.styleshout.com/">styleshout</a></span>	
                </div>

                <div class="go-top">
                <a class="smoothscroll" title="Back to Top" href="#top"><i class="im im-arrow-up" aria-hidden="true"></i></a>
                </div>
            </div>

        </div> <!-- end footer-bottom -->

    </footer> <!-- end footer -->
    <!-- Java Script
        ================================================== -->
        <script src="https://minglunwu.com/theme/js/jquery-3.2.1.min.js"></script>
        <script src="https://minglunwu.com/theme/js/plugins.js"></script>
        <script src="https://minglunwu.com/theme/js/main.js"></script>

    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-161863471-1"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-161863471-1');
    </script>
    
</body>