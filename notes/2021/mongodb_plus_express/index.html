<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:site_name" content="MingLun Blog"><meta property="og:type" content="article"><meta property="og:image" content="https://images.unsplash.com/photo-1501619757722-90657a99803b?ixid=MXwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHw%3D&ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80"><meta property="twitter:image" content="https://images.unsplash.com/photo-1501619757722-90657a99803b?ixid=MXwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHw%3D&ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80"><meta name=title content="使用Docker，快速佈建MongoDB + Mongo Express"><meta property="og:title" content="使用Docker，快速佈建MongoDB + Mongo Express"><meta property="twitter:title" content="使用Docker，快速佈建MongoDB + Mongo Express"><meta name=description content><meta property="og:description" content><meta property="twitter:description" content><meta property="twitter:card" content="使用Docker快速建立MongoDB以及Web IDE"><meta name=keyword content="吳明倫, MingLun, minglunwu"><link rel="shortcut icon" href=/img/favicon.ico><title>使用Docker，快速佈建MongoDB + Mongo Express | MingLun Blog</title><link rel=canonical href=/notes/2021/mongodb_plus_express/><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/hugo-theme-cleanwhite.min.css><link rel=stylesheet href=/css/zanshang.css><link rel=stylesheet href=/css/font-awesome.all.min.css><script src=/js/jquery.min.js></script>
<script src=/js/bootstrap.min.js></script>
<script src=/js/hux-blog.min.js></script>
<script src=/js/lazysizes.min.js></script></head><nav class="navbar navbar-default navbar-custom navbar-fixed-top"><div class=container-fluid><div class="navbar-header page-scroll"><button type=button class=navbar-toggle>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span></button>
<a class=navbar-brand href=/>MingLun Blog</a></div><div id=huxblog_navbar><div class=navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=/>All Posts</a></li><li><a href=/archive//>ARCHIVE</a></li><li><a href=/notes//>NOTES</a></li><li><a href=/about//>ABOUT</a></li><li><a href=/search><i class="fa fa-search"></i></a></li></ul></div></div></div></nav><script>var $body=document.body,$toggle=document.querySelector(".navbar-toggle"),$navbar=document.querySelector("#huxblog_navbar"),$collapse=document.querySelector(".navbar-collapse");$toggle.addEventListener("click",handleMagic);function handleMagic(){$navbar.className.indexOf("in")>0?($navbar.className=" ",setTimeout(function(){$navbar.className.indexOf("in")<0&&($collapse.style.height="0px")},400)):($collapse.style.height="auto",$navbar.className+=" in")}</script><style type=text/css>header.intro-header{background-image:url(https://images.unsplash.com/photo-1501619757722-90657a99803b?ixid=MXwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHw%3D&ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80)}</style><header class=intro-header><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><div class=tags><a class=tag href=/tags/docker title=Docker>Docker</a>
<a class=tag href=/tags/mongodb title=MongoDB>MongoDB</a></div><h1>使用Docker，快速佈建MongoDB + Mongo Express</h1><h2 class=subheading></h2><span class=meta>Posted by
MingLun Allen Wu
on
Wednesday, January 6, 2021</span></div></div></div></div></header><article><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
post-container"><ul><li><a href=#%E5%89%8D%E8%A8%80>前言</a></li><li><a href=#step-1-%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A>Step 1. 基本設定</a><ul><li><a href=#%E7%B6%B2%E8%B7%AF%E8%A8%AD%E5%AE%9A-docker-network>網路設定 (docker-network)</a><ul><li><a href=#%E5%BB%BA%E7%AB%8Bnetwork>建立Network</a></li></ul></li><li><a href=#%E8%A8%AD%E5%AE%9Avolume-optional>設定Volume (Optional)</a></li></ul></li><li><a href=#step-2-%E8%A8%AD%E5%AE%9A-mongodb>Step 2. 設定 MongoDB</a><ul><li><a href=#%E4%B8%8B%E8%BC%89-docker-image>下載 Docker Image</a></li><li><a href=#docker-run-%E6%A8%99%E7%B1%A4>Docker run 標籤</a><ul><li><a href=#%E8%A8%AD%E5%AE%9A%E7%92%B0%E5%A2%83%E8%AE%8A%E6%95%B8--e>設定環境變數 <code>-e</code></a></li><li><a href=#%E8%A8%AD%E5%AE%9A-volume--v>設定 Volume <code>-v</code></a></li><li><a href=#%E8%A8%AD%E5%AE%9A%E7%B6%B2%E8%B7%AF%E6%A8%A1%E5%BC%8F---network>設定網路模式 <code>--network</code></a></li><li><a href=#%E8%A8%AD%E5%AE%9A%E9%80%A3%E7%B7%9A-port--p>設定連線 Port <code>-p</code></a></li><li><a href=#%E5%95%9F%E5%8B%95-mongodb-container>啟動 MongoDB Container</a></li></ul></li></ul></li><li><a href=#step-3-%E8%A8%AD%E5%AE%9A-mongo-express>Step 3. 設定 Mongo Express</a><ul><li><a href=#%E4%B8%8B%E8%BC%89-docker-image-1>下載 Docker Image</a></li><li><a href=#%E7%92%B0%E5%A2%83%E8%AE%8A%E6%95%B8--e>環境變數 <code>-e</code></a></li><li><a href=#%E5%95%9F%E5%8B%95-mongo-express-container>啟動 Mongo Express Container</a></li></ul></li><li><a href=#%E7%B5%90%E8%AA%9E>結語</a></li></ul><p>最近工作時，需要寫爬蟲收集某些論壇的資料，不想要透過 <code>pickle</code> 或是 <code>csv</code> 來儲存有多層結構的資料。 但也不想要花費太多心力自行部署資料庫。</p><p>這篇筆記希望能: <strong>透過Docker快速的部署<code>MongoDB</code>及<code>Mongo Express</code></strong></p><p>我們要做的事情是:</p><ul><li>使用 Docker 建立一個 <code>MongoDB</code> Container：
省去繁瑣的安裝及設定，以最短的時間建立一個MongoDB服務。</li><li>使用 Docker 建立一個 <code>Mongo Express</code> Container:
這是一個輕量級的 MongoDB Web GUI，能夠透過網頁介面輕易地瀏覽資料結構、檔案內容。</li></ul><p>Mongo Express 的基本介紹請參閱<a href=https://github.com/mongo-express/mongo-express>官方 Github</a></p><p>在這個章節我們需要先進行基本的環境設定:</p><p>在這篇筆記中，我們會建立兩個 Docker Container，其中 <code>Mongo Express</code> 是 <code>MongoDB</code>的 GUI，兩個Container之間是需要連線的。</p><p>Docker Container 在建立時，可以設定不同的網路模式(Docker Network)，這關係到外部與Container的連線，大致上可以分為幾種模式:</p><ul><li><code>None</code>: 外部無法與Container進行任何連線。</li><li><code>Host</code>: 在主機A上開啟的Container B，可以直接在 <code>&lt;A的ip>:&lt;B開啟的port></code> 取得服務</li><li><code>Bridge</code>: 最常見的模式，可以想像成建立一個獨立的橋樑，啟動Container時可以指定此橋樑，則這些擁有橋樑的Container之間可以互通有無。 (我們建立一個橋樑，並且提供給 <code>MongoDB</code> 及 <code>Mongo Express</code>，則這兩者之間就能互相連線)</li><li><code>Overlay</code>: 適用於跨主機間的Docker連線。</li></ul><p>更多 Docker Network 的細節可以參考 <a href=https://yu-jack.github.io/2020/05/18/docker-network/>Docker 網路介紹</a> 這篇文章。</p><pre><code>:::bash
# docker network create -d &lt;模式&gt; &lt;名稱&gt;
docker network create -d bridge mongo-network  # 建立 Docker Network
docker network ls # 顯示所有的Docker Network
</code></pre><p>建立 <code>MongoDB</code> Container時，資料會儲存在 Container內部，在這樣的情境下是可以正常讀取/寫入的。</p><p>然而如果這個Container被移除(<code>docker rm</code>)後，裡面的資料就會全部消失了！ 這好嗎？ 這不好</p><p><strong>如果只是想要測試<code>MongoDB</code>的功能，不在乎資料遺失的話，可以直接跳過這個步驟！</strong></p><p>在建立Container時，通常會進行<strong>Volume</strong>的操作，也就是將 <strong>Container內部的某個資料夾</strong> 與 <strong>主機上的某個實體資料夾</strong> 綁定</p><p><strong>一榮俱榮、一損俱損，對實體資料夾的操作，也等於對Container內部的資料夾進行操作，反之亦然。</strong></p><p>Container內部有自己的資料夾結構，就像是個獨立的小世界，<code>MongoDB</code>在執行時會將資料以某種特定的形式寫入到「某個資料夾」中。 我們所要做的，就是將這個資料夾透過<code>volume</code>鏡像映射到主機的某個資料夾。</p><p>使用Volume有什麼好處呢？</p><p>資料儲存在實體主機上後，將不會因為Container的移除而消失。啟動新的Container時，只要在進行一次掛載，即可無痛將資料「放回」Container中。</p><p>接下來我們先在主機上創立一個實體的資料夾，用來存放Docker Volume的資料(路徑可以自訂)</p><pre><code>:::bash
mkdir /mnt/mongodb
</code></pre><p>Docker Image 部分使用官方提供的Docker File:
<a href=https://hub.docker.com/_/mongo>Docker Hub 連結 - MongoDB</a></p><p>其中也包含基本的設定文件。</p><pre><code>:::bash
docker pull mongo:latest # 從 Docker Hub 將 Image Pull到本地端
docker image # 確認本地端現有的 Docker Image
</code></pre><p>在建立Container時，會用到許多標籤，分別有不同的意義，接下來分別介紹:</p><p>在啟動 <code>MongoDB</code> 的 Container 時，需要設定兩個環境變數，這兩個變數是用來設定 <code>MongoDB</code>的最高權限使用者帳號及密碼:</p><ul><li><code>MONGO_INITDB_ROOT_USERNAME</code>: 帳號</li><li><code>MONGO_INITDB_ROOT_PASSWORD</code>: 密碼</li></ul><p>在啟動 Container 時，會透過 <code>-e</code> 標籤設定。</p><p>介紹完 Docker Volume 的好處後，在實際建立Container時會透過:</p><pre><code>:::bash
docker run &lt;image名稱&gt; -v &lt;實體資料夾路徑&gt;:&lt;container中資料夾路徑&gt;
</code></pre><p>來綁定 <strong>「主機上的實體資料夾」</strong> 及 <strong>「Container中的資料夾」</strong></p><p>記得在Container中的資料夾可不能隨便亂選，必須要選擇<code>MongoDB</code>實際儲存檔案的位置，這個位置可以從官方文件找到 : <code>/data/db</code></p><pre><code>:::bash
docker run &lt;image名稱&gt; -v &lt;實體資料夾路徑&gt;:/data/db
</code></pre><p>在第一小節介紹完並創立完 <code>Docker Network</code> ，在建立Container時透過:</p><pre><code>:::bash
docker run &lt;image名稱&gt; --network &lt;network名稱&gt;
</code></pre><p>來設定使用的網路模式。</p><p>啟動 <code>MongoDB</code> Container時， <code>MongoDB</code>預設會將服務開設於 <code>27017</code> port.</p><p>但可別忘了！ Container就像是一個小世界！ 我們需要將小世界中的 <code>27017</code> port 與 外面的主機連接在一起，這個動作稱之為 <code>Port Forwarding</code>:</p><pre><code>:::bash
# docker run &lt;image名稱&gt; -p &lt;外部的Port&gt;:&lt;Container的Port&gt;
docker run &lt;image名稱&gt; -p 8080:27017 # 將Container的27017連接到主機的8080 port，所以可以從主機呼叫 127.0.0.1:8080 來取得MongoDB的服務
</code></pre><p>了解各項標籤後，接下來我們看看完整指令:</p><pre><code>:::bash
docker run --name mongodb \ # 將這個Container命名為 mongodb
-e MONGO_INITDB_ROOT_USERNAME=&lt;USERNAME&gt; \ # 設定環境變數
-e MONGO_INITDB_ROOT_PASSWORD=&lt;PASSWORD&gt; \ # 設定環境變數
-v /mnt/mongodb:/data/db \ # 設定Volume
--network mongo-network \ # 在Step1. 設定的Docker Network
-p 27017:27017 # Port Forwarding
-d \ # 使整個Container在背景運行
mongo:latest # 此Container要使用的Docker Image
</code></pre><p>執行後如果沒有錯誤，透過下列語法:</p><pre><code>:::bash
docker ps
</code></pre><p>應該就能看到MongoDB正常運行！ 此時已經可以透過 <code>pymongo</code> 或是其他介面來進行操作。</p><p>接下來要安裝 <code>Mongo Express</code> 來更方便的查看 <code>MongoDB</code>中的資料。</p><p>在Step 2 了解 Docker 的各項標籤後，這個步驟非常快速！</p><pre><code>:::bash
docker pull mongo-express:latest # 從 Docker Hub 將 Image Pull到本地端
docker image # 確認本地端現有的 Docker Image
</code></pre><p><a href=https://hub.docker.com/_/mongo-express>Docker Hub 連結 - Mongo Express</a></p><p>與 <code>MongoDB</code> 一樣， <code>Mongo Express</code> 也提供了幾個環境變數讓使用者設定，這些設定的細節可以在上方連結中看到:</p><ul><li><code>ME_CONFIG_MONGODB_SERVER</code> : 這裡要放置的是<code>MongoDB</code> container的名稱 (<strong>mongodb</strong>)</li><li><code>ME_CONFIG_MONGODB_ADMINUSERNAME</code>: <code>MongoDB</code>的最高使用者帳號 (對應到<code>MongoDB</code>環境變數的<code>MONGO_INITDB_ROOT_USERNAME</code>)</li><li><code>ME_CONFIG_MONGODB_ADMINPASSWORD</code>: <code>MongoDB</code>的最高使用者密碼 (對應到<code>MongoDB</code>環境變數的<code>MONGO_INITDB_ROOT_PASSWORD</code>)</li><li><code>ME_CONFIG_BASICAUTH_USERNAME</code>: 連線至 <code>Mongo Express</code> 網頁時所需的登入帳號。</li><li><code>ME_CONFIG_BASICAUTH_PASSWORD</code>: 連線至 <code>Mongo Express</code> 網頁時所需的登入密碼。</li></ul><p>我們來看看完整的指令 :</p><pre><code>:::bash
docker run --name mongo_express  \ # 將 Container 命名為 mongo_express
--network mongo-network \ # 設定 Docker network為 mongo-network (與MongoDB同一個)
-e ME_CONFIG_MONGODB_SERVER=mongodb \ # 環境變數
-e ME_CONFIG_MONGODB_ADMINUSERNAME=&lt;USERNAME&gt; \ # 環境變數
-e ME_CONFIG_MONGODB_ADMINPASSWORD=&lt;PASSWORD&gt; \ # 環境變數
-e ME_CONFIG_BASICAUTH_USERNAME=&lt;USERNAME&gt; \ # 環境變數
-e ME_CONFIG_BASICAUTH_PASSWORD=&lt;PASSWORD&gt; \ # 環境變數
-p 8081:8081 \ # Port Forwarding
-d \ # 使Container在背景運行
mongo-express:latest # 此 Container 要使用的 Docker Image
</code></pre><p>執行成功後，此時在瀏覽器輸入 <code>127.0.0.1:8081</code> ，應該就會跳出登入頁面，輸入剛剛設定的環境變數 <code>ME_CONFIG_BASICAUTH_USERNAME</code> 及 <code>ME_CONFIG_BASICAUTH_PASSWORD</code>後，就能進入 <code>Mongo Express</code> 的頁面:</p><p><img src=https://camo.githubusercontent.com/bf9f84dbe8904f11cf1feee1257c384fc370f74b91aec78a27109466938c5676/687474703a2f2f692e696d6775722e636f6d2f58695968626c412e706e67 alt=img></p><p>能夠透過這個頁面進行基本的:</p><ul><li>Database創建</li><li>Collection創建</li><li>Query指令</li><li>確認 Data Schema</li></ul><p>透過 <code>Docker</code> 能夠在主機上快速的部署 <code>MongoDB</code>，不需要過多時間進行設定及安裝。</p><p>搭配 <code>Mongo Express</code> 能夠在三到五分鐘內建立好一套具有GUI的的完整資料庫！</p><p>祝大家都能快樂採芒果～</p><hr><ul class=pager><li class=previous><a href=/notes/2020/gitlab-ci-cd/ data-toggle=tooltip data-placement=top title="進職場學到的Git - (1) Gitlab CI/CD">&larr;
Previous Post</a></li><li class=next><a href=/notes/2021/fast_api_note_1/ data-toggle=tooltip data-placement=top title="Fast API 入門筆記 (一) - 基本介紹">Next
Post &rarr;</a></li></ul></div><div class="col-lg-2 col-lg-offset-0
visible-lg-block
sidebar-container
catalog-container"><div class=side-catalog><hr class="hidden-sm hidden-xs"><h5><a class=catalog-toggle href=#>CATALOG</a></h5><ul class=catalog-body></ul></div></div><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
sidebar-container"><section><hr class="hidden-sm hidden-xs"><h5><a href=/tags/>FEATURED TAGS</a></h5><div class=tags><a href=/tags/ansible title=ansible>ansible</a>
<a href=/tags/fast-api title=fast-api>fast-api</a>
<a href=/tags/python title=python>python</a>
<a href=/tags/test title=test>test</a>
<a href=/tags/tool title=tool>tool</a>
<a href=/tags/wsgi title=wsgi>wsgi</a></div></section></div></div></div></article><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"><li><a href=mailto:youremail@gmail.com><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-envelope fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=/your%20wechat%20qr%20code%20image><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-weixin fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://github.com/yourgithub><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://www.linkedin.com/in/yourlinkedinid><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-linkedin fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://stackoverflow.com/users/yourstackoverflowid><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-stack-overflow fa-stack-1x fa-inverse"></i></span></a></li><li><a href rel=alternate type=application/rss+xml title="MingLun Blog"><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-rss fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="copyright text-muted">Copyright &copy; MingLun Blog 2023<br><a href=https://themes.gohugo.io/hugo-theme-cleanwhite>CleanWhite Hugo Theme</a> by <a href=https://zhaohuabing.com>Huabing</a> |
<iframe style=margin-left:2px;margin-bottom:-5px frameborder=0 scrolling=0 width=100px height=20px src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true"></iframe></p></div></div></div></footer><script>function loadAsync(e,t){var s=document,o="script",n=s.createElement(o),i=s.getElementsByTagName(o)[0];n.src=e,t&&n.addEventListener("load",function(e){t(null,e)},!1),i.parentNode.insertBefore(n,i)}</script><script>$("#tag_cloud").length!==0&&loadAsync("/js/jquery.tagcloud.js",function(){$.fn.tagcloud.defaults={color:{start:"#bbbbee",end:"#0085a1"}},$("#tag_cloud a").tagcloud()})</script><script>loadAsync("https://cdn.jsdelivr.net/npm/fastclick@1.0.6/lib/fastclick.min.js",function(){var e=document.querySelector("nav");e&&FastClick.attach(e)})</script><script type=text/javascript>function generateCatalog(e){_containerSelector="div.post-container";var t,n,s,o,i,a=$(_containerSelector),r=a.find("h1,h2,h3,h4,h5,h6");return $(e).html(""),r.each(function(){t=$(this).prop("tagName").toLowerCase(),o="#"+$(this).prop("id"),n=$(this).text(),i=$('<a href="'+o+'" rel="nofollow">'+n+"</a>"),s=$('<li class="'+t+'_nav"></li>').append(i),$(e).append(s)}),!0}generateCatalog(".catalog-body"),$(".catalog-toggle").click(function(e){e.preventDefault(),$(".side-catalog").toggleClass("fold")}),loadAsync("/js/jquery.nav.js",function(){$(".catalog-body").onePageNav({currentClass:"active",changeHash:!1,easing:"swing",filter:"",scrollSpeed:700,scrollOffset:0,scrollThreshold:.2,begin:null,end:null,scrollChange:null,padding:80})})</script></body></html>