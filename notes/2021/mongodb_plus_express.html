<!DOCTYPE html>
<!--[if lt IE 9 ]><html class="no-js oldie" lang="en"> <![endif]-->
<!--[if IE 9 ]><html class="no-js oldie ie9" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->

<head>
        <!--- basic page needs
    ================================================== -->
    <meta charset="utf-8">
    <!--
    <meta name="description" content="">
    <meta name="author" content="">
    -->
    <!-- mobile specific metas
    ================================================== -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- CSS
    ================================================== -->
    <link rel="stylesheet" href="https://minglunwu.github.io/theme/css/base.css">
    <!--<link rel="stylesheet" href="https://minglunwu.github.io/theme/css/vendor.css">-->
    <link rel="stylesheet" href="https://minglunwu.github.io/theme/css/main.css">
    <link rel="stylesheet" href="https://minglunwu.github.io/theme/css/styles.css">

    <!-- script
    ================================================== -->
    <script src="https://minglunwu.github.io/theme/js/modernizr.js"></script>
    <script src="https://minglunwu.github.io/theme/js/pace.min.js"></script>
    <!--<script src="https://kit.fontawesome.com/968a4ded4c.js" crossorigin="anonymous"></script>-->

    <!-- favicons
    ================================================== -->
    <link rel="shortcut icon" href="https://minglunwu.github.io/theme/favicon.ico" type="image/x-icon">
    <link rel="icon" href="https://minglunwu.github.io/theme/favicon.ico" type="image/x-icon">

    <title>使用Docker，快速佈建MongoDB + Mongo Express</title>
    <meta property="og:title" content="使用Docker，快速佈建MongoDB + Mongo Express">
    <meta name="description" content="<p>使用Docker快速建立MongoDB以及Web IDE</p>">
    <meta property="og:description" content="<p>使用Docker快速建立MongoDB以及Web IDE</p>">
    <meta name="author" content="MingLun Allen Wu">
    <meta property="og:image" content="https://images.unsplash.com/photo-1501619757722-90657a99803b?ixid=MXwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHw%3D&ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80">
    
    <link rel="image_src" type="image/jpeg" href="https://images.unsplash.com/photo-1501619757722-90657a99803b?ixid=MXwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHw%3D&ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80" />
    <style>
        img{
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
    </style>
</head>

<body id="top">
            <!-- header
    ================================================== -->
    <header class="s-header">

        <div class="header-logo">
            <a class="site-logo" href="https://minglunwu.github.io"><img src="https://minglunwu.github.io/theme/images/logo.png" width="160" height="56" alt="Homepage"></a>
        </div>

        <nav class="header-nav-wrap">
            <ul class="header-nav">
                <li class="current"><a href="https://minglunwu.github.io/#home" title="home">Home</a></li>
                <li><a href="https://minglunwu.github.io/#about" title="about">About</a></li>
                <li><a href="https://minglunwu.github.io/#blog" title="blog">Blogs</a></li>
                <li><a href="https://minglunwu.github.io/#note" title="note">Notes</a></li>
                <!--<li><a class="smoothscroll" href="#note" title="notes">Notes</a></li>-->
                <!--<li><a class="smoothscroll"  href="#contact" title="contact">Contact</a></li>-->
            </ul>
        </nav>

        <a class="header-menu-toggle" href="#0"><span>Menu</span></a>

    </header> <!-- end s-header -->

        <article class="blog-single">

            <!-- page header/blog hero
            ================================================== -->
            <div class="page-header page-header--single page-hero" style="background-image:url(https://images.unsplash.com/photo-1501619757722-90657a99803b?ixid=MXwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHw%3D&ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80)">
            
                <div class="row page-header__content narrow">
                    <article class="col-full">
                        <div class="page-header__info">
                            <div class="page-header__cat">
                                    <a href="#0">Docker</a>
                                    <a href="#0">MongoDB</a>
                            </div>
                        </div>
                        <h1 class="page-header__title">
                            <a href="#0" title="">
                                使用Docker，快速佈建MongoDB + Mongo Express
                            </a>
                        </h1>
                        <ul class="page-header__meta">
                            <li class="date">2021- 1-06 (三)</li>
                            <li class="author">
                                By
                                <span>MingLun Allen Wu</span>
                            </li>
                        </ul>
                        
                    </article>
                </div>
        
            </div> <!-- end page-header -->
    
            <div class="row blog-content">
                <div class="col-full blog-content__main">
                    
                    <ul>
<li><a href="#前言">前言</a></li>
<li><a href="#step-1-基本設定">Step 1. 基本設定</a></li>
<li><a href="#網路設定-docker-network">網路設定 (docker-network)</a><ul>
<li><a href="#建立network">建立Network</a></li>
</ul>
</li>
<li><a href="#設定volume-optional">設定Volume (Optional)</a></li>
<li><a href="#step-2-設定-mongodb">Step 2. 設定 MongoDB</a></li>
<li><a href="#下載-docker-image">下載 Docker Image</a></li>
<li><a href="#docker-run-標籤">Docker run 標籤</a><ul>
<li><a href="#設定環境變數--e">設定環境變數 <code>-e</code></a></li>
<li><a href="#設定-volume--v">設定 Volume <code>-v</code></a></li>
<li><a href="#設定網路模式---network">設定網路模式 <code>--network</code></a></li>
<li><a href="#設定連線-port--p">設定連線 Port <code>-p</code></a></li>
<li><a href="#啟動-mongodb-container">啟動 MongoDB Container</a></li>
</ul>
</li>
<li><a href="#step-3-設定-mongo-express">Step 3. 設定 Mongo Express</a></li>
<li><a href="#下載-docker-image-1">下載 Docker Image</a></li>
<li><a href="#環境變數--e">環境變數 <code>-e</code></a></li>
<li><a href="#啟動-mongo-express-container">啟動 Mongo Express Container</a></li>
<li><a href="#結語">結語</a></li>
</ul>
<p id="前言"></p>

<h1>前言</h1>
<p>最近工作時，需要寫爬蟲收集某些論壇的資料，不想要透過 <code>pickle</code> 或是 <code>csv</code> 來儲存有多層結構的資料。 但也不想要花費太多心力自行部署資料庫。 </p>
<p>這篇筆記希望能: <strong>透過Docker快速的部署<code>MongoDB</code>及<code>Mongo Express</code></strong></p>
<p>我們要做的事情是: </p>
<ul>
<li>使用 Docker 建立一個 <code>MongoDB</code> Container：
    省去繁瑣的安裝及設定，以最短的時間建立一個MongoDB服務。</li>
<li>使用 Docker 建立一個 <code>Mongo Express</code> Container:
    這是一個輕量級的 MongoDB Web GUI，能夠透過網頁介面輕易地瀏覽資料結構、檔案內容。</li>
</ul>
<p>Mongo Express 的基本介紹請參閱<a href="https://github.com/mongo-express/mongo-express">官方 Github</a></p>
<p id="step-1-基本設定"></p>

<h1>Step 1. 基本設定</h1>
<p>在這個章節我們需要先進行基本的環境設定: </p>
<p id="網路設定-docker-network"></p>

<h2>網路設定 (docker-network)</h2>
<p>在這篇筆記中，我們會建立兩個 Docker Container，其中 <code>Mongo Express</code> 是 <code>MongoDB</code>的 GUI，兩個Container之間是需要連線的。</p>
<p>Docker Container 在建立時，可以設定不同的網路模式(Docker Network)，這關係到外部與Container的連線，大致上可以分為幾種模式: </p>
<ul>
<li><code>None</code>: 外部無法與Container進行任何連線。</li>
<li><code>Host</code>: 在主機A上開啟的Container B，可以直接在 <code>&lt;A的ip&gt;:&lt;B開啟的port&gt;</code> 取得服務</li>
<li><code>Bridge</code>: 最常見的模式，可以想像成建立一個獨立的橋樑，啟動Container時可以指定此橋樑，則這些擁有橋樑的Container之間可以互通有無。 (我們建立一個橋樑，並且提供給 <code>MongoDB</code> 及 <code>Mongo Express</code>，則這兩者之間就能互相連線)</li>
<li><code>Overlay</code>: 適用於跨主機間的Docker連線。</li>
</ul>
<p>更多 Docker Network 的細節可以參考 <a href="https://yu-jack.github.io/2020/05/18/docker-network/">Docker 網路介紹</a> 這篇文章。</p>
<p id="建立network"></p>

<h3>建立Network</h3>
<div class="highlight"><pre><span></span><span class="c1"># docker network create -d &lt;模式&gt; &lt;名稱&gt;</span>
docker network create -d bridge mongo-network  <span class="c1"># 建立 Docker Network</span>
docker network ls <span class="c1"># 顯示所有的Docker Network</span>
</pre></div>


<p id="設定volume-optional"></p>

<h2>設定Volume (Optional)</h2>
<p>建立 <code>MongoDB</code> Container時，資料會儲存在 Container內部，在這樣的情境下是可以正常讀取/寫入的。</p>
<p>然而如果這個Container被移除(<code>docker rm</code>)後，裡面的資料就會全部消失了！ 這好嗎？ 這不好</p>
<p><strong>如果只是想要測試<code>MongoDB</code>的功能，不在乎資料遺失的話，可以直接跳過這個步驟！</strong></p>
<p>在建立Container時，通常會進行<strong>Volume</strong>的操作，也就是將 <strong>Container內部的某個資料夾</strong> 與 <strong>主機上的某個實體資料夾</strong> 綁定</p>
<p><strong>一榮俱榮、一損俱損，對實體資料夾的操作，也等於對Container內部的資料夾進行操作，反之亦然。</strong></p>
<p>Container內部有自己的資料夾結構，就像是個獨立的小世界，<code>MongoDB</code>在執行時會將資料以某種特定的形式寫入到「某個資料夾」中。 我們所要做的，就是將這個資料夾透過<code>volume</code>鏡像映射到主機的某個資料夾。</p>
<p>使用Volume有什麼好處呢？</p>
<p>資料儲存在實體主機上後，將不會因為Container的移除而消失。啟動新的Container時，只要在進行一次掛載，即可無痛將資料「放回」Container中。</p>
<p>接下來我們先在主機上創立一個實體的資料夾，用來存放Docker Volume的資料(路徑可以自訂)</p>
<div class="highlight"><pre><span></span>mkdir /mnt/mongodb
</pre></div>


<p id="#step-2-設定-mongodb"></p>

<h1>Step 2. 設定 MongoDB</h1>
<p>Docker Image 部分使用官方提供的Docker File: 
<a href="https://hub.docker.com/_/mongo">Docker Hub 連結 - MongoDB</a></p>
<p>其中也包含基本的設定文件。</p>
<p id="下載-docker-image"></p>

<h2>下載 Docker Image</h2>
<div class="highlight"><pre><span></span>docker pull mongo:latest <span class="c1"># 從 Docker Hub 將 Image Pull到本地端</span>
docker image <span class="c1"># 確認本地端現有的 Docker Image</span>
</pre></div>


<p id="docker-run-標籤"></p>

<h2>Docker run 標籤</h2>
<p>在建立Container時，會用到許多標籤，分別有不同的意義，接下來分別介紹:</p>
<p id="設定環境變數--e"></p>

<h3>設定環境變數 <code>-e</code></h3>
<p>在啟動 <code>MongoDB</code> 的 Container 時，需要設定兩個環境變數，這兩個變數是用來設定 <code>MongoDB</code>的最高權限使用者帳號及密碼: </p>
<ul>
<li><code>MONGO_INITDB_ROOT_USERNAME</code>: 帳號</li>
<li><code>MONGO_INITDB_ROOT_PASSWORD</code>: 密碼</li>
</ul>
<p>在啟動 Container 時，會透過 <code>-e</code> 標籤設定。</p>
<p id="設定-volume---e"></p>

<h3>設定 Volume <code>-v</code></h3>
<p>介紹完 Docker Volume 的好處後，在實際建立Container時會透過:</p>
<div class="highlight"><pre><span></span>docker run &lt;image名稱&gt; -v &lt;實體資料夾路徑&gt;:&lt;container中資料夾路徑&gt;
</pre></div>


<p>來綁定 <strong>「主機上的實體資料夾」</strong> 及 <strong>「Container中的資料夾」</strong></p>
<p>記得在Container中的資料夾可不能隨便亂選，必須要選擇<code>MongoDB</code>實際儲存檔案的位置，這個位置可以從官方文件找到 : <code>/data/db</code></p>
<div class="highlight"><pre><span></span>docker run &lt;image名稱&gt; -v &lt;實體資料夾路徑&gt;:/data/db
</pre></div>


<p id="設定網路模式---network"></p>

<h3>設定網路模式 <code>--network</code></h3>
<p>在第一小節介紹完並創立完 <code>Docker Network</code> ，在建立Container時透過:</p>
<div class="highlight"><pre><span></span>docker run &lt;image名稱&gt; --network &lt;network名稱&gt;
</pre></div>


<p>來設定使用的網路模式。</p>
<p id="設定連線-port--p"></p>

<h3>設定連線 Port <code>-p</code></h3>
<p>啟動 <code>MongoDB</code> Container時， <code>MongoDB</code>預設會將服務開設於 <code>27017</code> port.</p>
<p>但可別忘了！ Container就像是一個小世界！ 我們需要將小世界中的 <code>27017</code> port 與 外面的主機連接在一起，這個動作稱之為 <code>Port Forwarding</code>:</p>
<div class="highlight"><pre><span></span><span class="c1"># docker run &lt;image名稱&gt; -p &lt;外部的Port&gt;:&lt;Container的Port&gt;</span>
docker run &lt;image名稱&gt; -p <span class="m">8080</span>:27017 <span class="c1"># 將Container的27017連接到主機的8080 port，所以可以從主機呼叫 127.0.0.1:8080 來取得MongoDB的服務</span>
</pre></div>


<p id="啟動-mongodb-container"></p>

<h3>啟動 MongoDB Container</h3>
<p>了解各項標籤後，接下來我們看看完整指令: </p>
<div class="highlight"><pre><span></span>docker run --name mongodb <span class="se">\ </span><span class="c1"># 將這個Container命名為 mongodb</span>
-e <span class="nv">MONGO_INITDB_ROOT_USERNAME</span><span class="o">=</span>&lt;USERNAME&gt; <span class="se">\ </span><span class="c1"># 設定環境變數</span>
-e <span class="nv">MONGO_INITDB_ROOT_PASSWORD</span><span class="o">=</span>&lt;PASSWORD&gt; <span class="se">\ </span><span class="c1"># 設定環境變數</span>
-v /mnt/mongodb:/data/db <span class="se">\ </span><span class="c1"># 設定Volume</span>
--network mongo-network <span class="se">\ </span><span class="c1"># 在Step1. 設定的Docker Network</span>
-p <span class="m">27017</span>:27017 <span class="c1"># Port Forwarding</span>
-d <span class="se">\ </span><span class="c1"># 使整個Container在背景運行</span>
mongo:latest <span class="c1"># 此Container要使用的Docker Image</span>
</pre></div>


<p>執行後如果沒有錯誤，透過下列語法:</p>
<div class="highlight"><pre><span></span>docker ps
</pre></div>


<p>應該就能看到MongoDB正常運行！ 此時已經可以透過 <code>pymongo</code> 或是其他介面來進行操作。</p>
<p>接下來要安裝 <code>Mongo Express</code> 來更方便的查看 <code>MongoDB</code>中的資料。</p>
<p id="step-3-設定-mongo-express"></p>

<h1>Step 3. 設定 Mongo Express</h1>
<p>在Step 2 了解 Docker 的各項標籤後，這個步驟非常快速！</p>
<p id="下載-docker-image-1"></p>

<h2>下載 Docker Image</h2>
<div class="highlight"><pre><span></span>docker pull mongo-express:latest <span class="c1"># 從 Docker Hub 將 Image Pull到本地端</span>
docker image <span class="c1"># 確認本地端現有的 Docker Image</span>
</pre></div>


<p><a href="https://hub.docker.com/_/mongo-express">Docker Hub 連結 - Mongo Express</a></p>
<p id="環境變數--e"></p>

<h2>環境變數 <code>-e</code></h2>
<p>與 <code>MongoDB</code> 一樣， <code>Mongo Express</code> 也提供了幾個環境變數讓使用者設定，這些設定的細節可以在上方連結中看到:</p>
<ul>
<li><code>ME_CONFIG_MONGODB_SERVER</code> : 這裡要放置的是<code>MongoDB</code> container的名稱 (<strong>mongodb</strong>)</li>
<li><code>ME_CONFIG_MONGODB_ADMINUSERNAME</code>: <code>MongoDB</code>的最高使用者帳號 (對應到<code>MongoDB</code>環境變數的<code>MONGO_INITDB_ROOT_USERNAME</code>)</li>
<li><code>ME_CONFIG_MONGODB_ADMINPASSWORD</code>: <code>MongoDB</code>的最高使用者密碼 (對應到<code>MongoDB</code>環境變數的<code>MONGO_INITDB_ROOT_PASSWORD</code>)</li>
<li><code>ME_CONFIG_BASICAUTH_USERNAME</code>: 連線至 <code>Mongo Express</code> 網頁時所需的登入帳號。</li>
<li><code>ME_CONFIG_BASICAUTH_PASSWORD</code>: 連線至 <code>Mongo Express</code> 網頁時所需的登入密碼。</li>
</ul>
<p id="啟動-mongo-express-container"></p>

<h2>啟動 Mongo Express Container</h2>
<p>我們來看看完整的指令 : </p>
<div class="highlight"><pre><span></span>docker run --name mongo_express  <span class="se">\ </span><span class="c1"># 將 Container 命名為 mongo_express</span>
--network mongo-network <span class="se">\ </span><span class="c1"># 設定 Docker network為 mongo-network (與MongoDB同一個)</span>
-e <span class="nv">ME_CONFIG_MONGODB_SERVER</span><span class="o">=</span>mongodb <span class="se">\ </span><span class="c1"># 環境變數</span>
-e <span class="nv">ME_CONFIG_MONGODB_ADMINUSERNAME</span><span class="o">=</span>&lt;USERNAME&gt; <span class="se">\ </span><span class="c1"># 環境變數</span>
-e <span class="nv">ME_CONFIG_MONGODB_ADMINPASSWORD</span><span class="o">=</span>&lt;PASSWORD&gt; <span class="se">\ </span><span class="c1"># 環境變數</span>
-e <span class="nv">ME_CONFIG_BASICAUTH_USERNAME</span><span class="o">=</span>&lt;USERNAME&gt; <span class="se">\ </span><span class="c1"># 環境變數</span>
-e <span class="nv">ME_CONFIG_BASICAUTH_PASSWORD</span><span class="o">=</span>&lt;PASSWORD&gt; <span class="se">\ </span><span class="c1"># 環境變數</span>
-p <span class="m">8081</span>:8081 <span class="se">\ </span><span class="c1"># Port Forwarding</span>
-d <span class="se">\ </span><span class="c1"># 使Container在背景運行</span>
mongo-express:latest <span class="c1"># 此 Container 要使用的 Docker Image</span>
</pre></div>


<p>執行成功後，此時在瀏覽器輸入 <code>127.0.0.1:8081</code> ，應該就會跳出登入頁面，輸入剛剛設定的環境變數 <code>ME_CONFIG_BASICAUTH_USERNAME</code> 及 <code>ME_CONFIG_BASICAUTH_PASSWORD</code>後，就能進入 <code>Mongo Express</code> 的頁面: </p>
<p><img alt="img" src="https://camo.githubusercontent.com/bf9f84dbe8904f11cf1feee1257c384fc370f74b91aec78a27109466938c5676/687474703a2f2f692e696d6775722e636f6d2f58695968626c412e706e67"></p>
<p>能夠透過這個頁面進行基本的: </p>
<ul>
<li>Database創建</li>
<li>Collection創建</li>
<li>Query指令</li>
<li>確認 Data Schema</li>
</ul>
<p id="結語"></p>

<h1>結語</h1>
<p>透過 <code>Docker</code> 能夠在主機上快速的部署 <code>MongoDB</code>，不需要過多時間進行設定及安裝。</p>
<p>搭配 <code>Mongo Express</code> 能夠在三到五分鐘內建立好一套具有GUI的的完整資料庫！</p>
<p>祝大家都能快樂採芒果～</p>
    
                    <p class="blog-content__tags">
                        <span>Post Tags</span>
    
                        <span class="blog-content__tag-list">
                             <a href="#0">Docker</a>
                             <a href="#0">MongoDB</a>
                        </span>
    
                    </p>
    
                    <div class="blog-content__pagenav">
                        <div class="blog-content__nav">






















                            <div class="blog-content__prev">
                                <a href="https://minglunwu.github.io/notes/2021/fast_api_note_2.html" rel="prev">
                                    <span>Previous Post</span>
                                    Fast API 入門筆記 (二)
                                </a>
                            </div>
                            <div class="blog-content__next">
                                <a href="https://minglunwu.github.io/notes/2020/gitlab-ci-cd.html" rel="next">
                                    <span>Next Post</span>
                                    進職場學到的Git - (1) Gitlab CI/CD
                                </a>
                            </div>
                        </div>
    
                        <div class="blog-content__all">
                            <a href="https://minglunwu.github.io/archives.html" class="btn btn--primary">
                                View All Post
                            </a>
                        </div>
                    </div>
    
                </div><!-- end blog-content__main -->
            </div> <!-- end blog-content -->
    
        </article>
            <!-- footer
    ================================================== -->
    <footer>
        <div class="row">
            <div class="col-full">

                <div class="footer-logo">
                    <a class="footer-site-logo" href="#0"><img src="https://minglunwu.github.io/theme/images/logo.png" alt="Homepage"></a>
                </div>
                <ul class="footer-social">
                    <li>
                        <a href="https://www.facebook.com/zebra52000" target="_blank"><i class="im im-facebook" aria-hidden="true"></i><span>Facebook</span></a>
                    </li>
                    <li>
                        <a href="https://medium.com/@allen6997535" target="_blank"><i class="im im-book" aria-hidden="true"></i><span>Medium</span></a>
                    </li>
                    <li>
                        <a href="https://github.com/MingLunWu" target="_blank"><i class="im im-github" aria-hidden="true"></i><span>Github</span></a>
                    </li>
                    <li>
                        <a href="https://www.linkedin.com/in/allen-ming-lun-wu-637020142/" target="_blank"><i class="im im-linkedin" aria-hidden="true"></i><span>LinkedIn</span></a>
                    </li>
                    <li>
                        <a href="https://www.instagram.com/whoisfater0724/" target="_blank"><i class="im im-instagram" aria-hidden="true"></i><span>Instagram</span></a>
                    </li>
                </ul>
                    
            </div>
        </div>

        <div class="row footer-bottom">

            <div class="col-twelve">
                <div class="copyright">
                    <span>© Copyright Hola 2017</span> 
                    <span>Design by <a href="https://www.styleshout.com/">styleshout</a></span>	
                </div>

                <div class="go-top">
                <a class="smoothscroll" title="Back to Top" href="#top"><i class="im im-arrow-up" aria-hidden="true"></i></a>
                </div>
            </div>

        </div> <!-- end footer-bottom -->

    </footer> <!-- end footer -->
    <!-- Java Script
        ================================================== -->
        <script src="https://minglunwu.github.io/theme/js/jquery-3.2.1.min.js"></script>
        <script src="https://minglunwu.github.io/theme/js/plugins.js"></script>
        <script src="https://minglunwu.github.io/theme/js/main.js"></script>

    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-161863471-1"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-161863471-1');
    </script>
    
</body>