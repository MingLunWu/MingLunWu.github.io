<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <meta property="og:site_name" content="MingLun Blog">
    <meta property="og:type" content="article">

    
    <meta property="og:image" content="https://minglunwu.com/img/home-bg-night.webp">
    <meta property="twitter:image" content="https://minglunwu.com/img/home-bg-night.webp" />
    

    
    <meta name="title" content="Pytorch Lightning 入門筆記" />
    <meta property="og:title" content="Pytorch Lightning 入門筆記" />
    <meta property="twitter:title" content="Pytorch Lightning 入門筆記" />
    

    
    <meta name="description" content="">
    <meta property="og:description" content="" />
    <meta property="twitter:description" content="" />
    

    
    <meta property="twitter:card" content="Pytorch Lightning 是Pytorch的一種開發框架，目的是在撰寫Deep Learning的模型時，將注意力放在模型本身即可，由此框架來代為處理常見且繁瑣的工作(例如:Optimze、update parameter、check log、save checkpoints等等）。" />
    
    

    <meta name="keyword"  content="吳明倫, MingLun, minglunwu">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>Pytorch Lightning 入門筆記 | MingLun Blog</title>

    <link rel="canonical" href="/notes/2020/20200416/">

    
    
    
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    
    <link rel="stylesheet" href="/css/hugo-theme-cleanwhite.min.css">

    
    <link rel="stylesheet" href="/css/zanshang.css">

    
    <link rel="stylesheet" href="/css/font-awesome.all.min.css">

    
    

    
    <script src="/js/jquery.min.js"></script>

    
    <script src="/js/bootstrap.min.js"></script>

    
    <script src="/js/hux-blog.min.js"></script>

    
    <script src="/js/lazysizes.min.js"></script>

    
    

</head>






<nav class="navbar navbar-default navbar-custom navbar-fixed-top">

    <div class="container-fluid">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">MingLun Blog</a>
        </div>

        
        
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">All Posts</a>
                    </li>
                    
                        
                    
                    
		    
                        <li><a href="/archive//">ARCHIVE</a></li>
                    
                        <li><a href="/notes//">NOTES</a></li>
                    
                        <li><a href="/about//">ABOUT</a></li>
                    
		            <li>
                        <a href="/search"><i class="fa fa-search"></i></a>
		           </li>
                </ul>
            </div>
        </div>
        
    </div>
    
</nav>
<script>
    
    
    
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        
            $navbar.className = " ";
            
            setTimeout(function(){
                
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>




<style type="text/css">
    header.intro-header {
        background-image: url('/img/home-bg-night.webp')
    }
</style>

<header class="intro-header" >

    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/pytorch" title="Pytorch">
                            Pytorch
                        </a>
                        
                    </div>
                    <h1>Pytorch Lightning 入門筆記</h1>
                    <h2 class="subheading"></h2>
                    <span class="meta">
                        
                            Posted by 
                            
                                MingLun Allen Wu
                             
                            on 
                            Thursday, April 16, 2020
                            
                            
                            
                            
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>




<article>
    <div class="container">
        <div class="row">

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                
                <ul>
<li><a href="#%E5%89%8D%E8%A8%80">前言</a>
<ul>
<li><a href="#%E5%BE%9E%E9%9B%B6%E9%96%8B%E5%A7%8B---pytorch%E5%85%A5%E9%96%80%E6%87%B6%E4%BA%BA%E5%8C%85">從零開始 - Pytorch入門懶人包</a></li>
</ul>
</li>
<li><a href="#%E7%B0%A1%E4%BB%8B">簡介</a></li>
<li><a href="#%E4%B8%80%E5%AE%89%E8%A3%9D">一、安裝</a></li>
<li><a href="#%E4%BA%8C%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5">二、基本概念</a></li>
<li><a href="#%E4%B8%89-research-code">三、 Research Code</a></li>
<li><a href="#%E5%9B%9B%E9%80%8F%E9%81%8Etrainer%E8%87%AA%E5%8B%95%E8%A8%93%E7%B7%B4">四、透過Trainer自動訓練</a>
<ul>
<li><a href="#training">Training</a></li>
<li><a href="#evaluation--inference">Evaluation / Inference</a></li>
</ul>
</li>
<li><a href="#%E4%BA%94%E5%BE%8C%E8%A8%98">五、後記</a></li>
</ul>
<hr>
<!-- raw HTML omitted -->
<h2 id="從零開始---pytorch入門懶人包httpsminglunwugithubionotes202020200324html"><a href="https://minglunwu.github.io/notes/2020/20200324.html">從零開始 - Pytorch入門懶人包</a></h2>
<!-- raw HTML omitted -->
<p>透過Pytorch撰寫Deep Learning相關程式碼時，程式碼大致可分成兩種類型:</p>
<ol>
<li>
<p><strong>依照專案有所不同</strong>: 這類程式碼會根據開發的需求而改變，例如「資料的前處理」、「模型的架構」。</p>
</li>
<li>
<p><strong>跨專案重複使用</strong>: 這類程式碼在每一個應用中都會存在，且相似性非常高，例如「將資料送入DataLoader」、「計算Loss」、「透過Optimizer更新模型的weight」。</p>
</li>
</ol>
<hr>
<p><code>Pytorch Lightning</code>希望替使用者簡化的就是「<strong>跨專案重複使用</strong>」這部分的程式碼，讓使用者能省下精力及時間去處理更為重要的核心模型部分。</p>
<p>你可以將其視為是一種「樣式指南」(類似Python的PEP8)，透過一定規則將訓練過程中的幾個重要步驟封裝起來(Train, 計算Loss, Optimizer, 更新參數)。</p>
<p>你可能很好奇這樣做的用意是什麼？ 你將可以透過特別的 <code>Trainer</code> Class來進行操作，不再需要花費時間撰寫 Evaluation的Loss、或是在每一個Epoch結束時顯示Loss、固定幾個Step要顯示當前訓練狀態、儲存Validation表現最好的Checkpoint。 <strong>只要你先按照Pytorch Lightning的格式封裝程式碼，在訓練時的瑣碎細節它會幫你處理好。</strong></p>
<p>下面這張圖則是Pytorch Lightning 官網的例子，用來說明Pytorch Lightning 想要簡化的部分。

  <img src="https://pytorch-lightning.readthedocs.io/en/latest/_images/pt_trainer.png" alt="">

</p>
<p>我們來看個較為實際的例子:</p>
<pre><code>:::python
model = SomeModel() # 假設這是你按照Pytorch Lightning封裝好的Model.
# 透過GPU訓練
trainer = Trainer(gpus=1, precision=16)
trainer.fit(model) 

# 透過CPU訓練
trainer = Trainer(gpus=0)
trainer.fit(model)

# 進行Evaluation
trainer.test()
</code></pre>
<p>從上面的範例中可以看到，原先冗長的訓練過程現在只需要透過短短的幾行程式碼即可實現。將訓練時的細節按照特定規則封裝好後，就可直接透過 <code>Trainer</code> Class來進行訓練。</p>
<hr>
<!-- raw HTML omitted -->
<pre><code>:::bash
pip install pytorch-lightning==0.7.1
</code></pre>
<hr>
<!-- raw HTML omitted -->
<ol>
<li>
<p><strong>Research Code</strong>:
整個應用的核心架構，可能會根據任務的內容進行調整、或是在開發過程中加入自己的想法。通常可能會包含幾個核心元件:</p>
<ul>
<li>模型架構定義</li>
<li>Train/Val/Test資料切分</li>
<li>Optimizer定義</li>
<li>Train/Val/Test Step Computation.</li>
</ul>
</li>
<li>
<p><strong>Engineer Code</strong>:</p>
<p>「EarlyStopping」, 「將資料送入GPU」等常見且不同專案使用方式都類似的程式碼。這部分的程式碼是 <code>Pytorch Lightning</code>最希望能簡化的。</p>
</li>
<li>
<p><strong>Non-Essential Code</strong>:</p>
<p>檢查梯度、視覺化等偏向輔助性質的功能。</p>
</li>
</ol>
<p><code>Pytorch Lightning</code>希望使用者只需要定義<strong>Research Code</strong>，而<strong>Engineer Code</strong>由它來代為處理、<strong>Non-Essential</strong>則是根據使用者的需要自行選用，由於不會影響正常使用，接下來我們著重探討如何重新將<strong>Research Code</strong>組織為<code>Pytorch Lightning</code>的格式。</p>
<hr>
<!-- raw HTML omitted -->
<p>針對模型開發中最為重要的就是 Research Code了，在 <code>Pytorch Lightning</code>中透過 <code>pl.LightningModule</code>模組來實現，這個模組繼承了<code>torch.nn.Module</code>的功能，所以使用上其實跟使用原生Pytorch是相當類似的。</p>
<p>實作時只需在定義的Class上繼承pl.LightningModule即可。</p>
<pre><code>:::python
import pytorch_lightning as pl

class YourOwnNet(pl.LightningModule):

    def somemethod(self):
        pass
</code></pre>
<p>在繼承 <code>pl.LightingModule</code>後，有幾項重要的Method必須被Override，未來 <code>Pytorch Lightning</code>才能自動地進行訓練，以下將這些方法及目的條列出來:</p>
<ul>
<li>
<h4 id="prepare_data"><strong>prepare_data()</strong>:</h4>
<p>負責資料的載入(包含Training Set, Evaluation Set, Test)都撰寫在方法中。 自動訓練時會優先執行此Method以獲取資料。</p>
</li>
<li>
<h4 id="configure_optimizerself"><strong>configure_optimizer(self)</strong>:</h4>
<ul>
<li>
<p><strong>回傳特定的優化器</strong> (torch.nn.optimizer)</p>
</li>
<li>
<p>如果對於優化的參數有任何設定(例如只想對特定參數進行調整)，也是在這個地方調整。</p>
</li>
<li>
<p>在自動訓練時，會呼叫此方法來取得Optimizer。</p>
<pre><code>  :::python
  def configure_optimizers(self):
          return Adam(self.parameters(), lr=1e-3)
</code></pre>
</li>
</ul>
</li>
<li>
<h4 id="train_dataloaderself--val_dataloaderself--test_dataloaderself"><strong>train_dataloader(self)</strong> / <strong>val_dataloader(self)</strong> / <strong>test_dataloader(self)</strong>:</h4>
<ul>
<li>
<p><strong>回傳<code>Pytorch</code>的 <code>DataLoader</code> Object</strong>，</p>
</li>
<li>
<p>這三個方法定義了training/ validation/ test時使用的DataLoader。其中會使用到的資料可以透過 <code>prepare_data()</code>先行取得。</p>
</li>
<li>
<p>在自動訓練的過程中，會呼叫這邊定義的Function來取得不同時期(Train/Validation/Test)的DataLoader。</p>
<pre><code>  :::python
  def train_dataloader(self):
      # self.train_dataset 通常由 self.prepare_data()產生.
      return DataLoader(self.train_dataset, batch_size= self.batch_size, shuffle=True) 
</code></pre>
</li>
</ul>
</li>
<li>
<h4 id="forwardself-args"><strong>forward(self, args)</strong>:</h4>
<ul>
<li>
<p>定義當前這個模型forward propagation時所要進行的動作。</p>
</li>
<li>
<p>特別注意在建立instance時，直接將參數傳入instance等同於呼叫forward function。來個具體例子。</p>
<pre><code>  :::python
  model = TestModel()
  x = torch.Tensor([1, 2, 3])
  output1 = model(x)
  output2 = model.forward(x)
  output1 == output2  # 實際上這兩個是相同的.
</code></pre>
</li>
</ul>
</li>
<li>
<h4 id="training_stepval_steptest_stepself-batch-batch_idx"><strong>training_step/val_step/test_step(self, batch, batch_idx)</strong>:</h4>
<ul>
<li>
<p>分別定義了traing/ validation/ test時的每一個Step所要進行的任務，其中較特別的是參數<code>batch</code>, <code>batch_idx</code>，這是會自動從<code>train/val/test_dataloader()</code>中的<code>DataLoader</code>取出一個batch。具體使用方式請見下方範例。</p>
</li>
<li>
<p>此類型方法的回傳值有一定的格式，需要回傳一個Python的Dictionary，其中包含:</p>
<ul>
<li>
<p>loss: 當前Step計算出來的Training Loss. 用於接下來的Backward Propagation及參數調校。</p>
</li>
<li>
<p>log: 包含當前訓練的狀況，在訓練時會自動回傳成進度條。 如下圖所示:

  <img src="https://minglunwu.github.io/theme/images/20200414.png" alt="">

</p>
<pre><code>  :::python
  def training_step(self, batch, batch_idx):
      x, y = batch  # 這裡的batch會對應到 self.train_dataloader()所回傳的DataLoader Object，對其取用一個batch.

      output = self.forward(x) # 將Input進行 forward propagation.
      criterion = nn.CrossEntropyLoss()
      loss = criterion(output, y)
      logs = {&quot;loss&quot;: loss}
      return {&quot;loss&quot;: loss, &quot;log&quot;: logs}
</code></pre>
</li>
</ul>
</li>
</ul>
</li>
<li>
<h4 id="trainingvalidationtest_epoch_endself-outputs"><strong>(training/validation/test)_epoch_end(self, outputs)</strong>:</h4>
<ul>
<li>
<p>定義了「不同時期訓練完一個epoch時需要執行的事項」，舉例來說可能會在Validation的一個Epoch結束時計算所有Step平均的Loss是多少。</p>
</li>
<li>
<p><code>outputs</code> 參數為「當前Epoch中所有Step的{&ldquo;loss&rdquo;: loss, &ldquo;logs&rdquo;: logs}」(也就是每一個self.training_step()的回傳值)。</p>
</li>
<li>
<p>以下範例示範了在「每一個Validation Epoch結束後計算Average Loss」。</p>
<pre><code>  :::python
  def validation_epoch_end(self, outputs):
          avg_loss = torch.stack([x['val_loss'] for x in outputs]).mean()
          avg_val_acc = torch.stack([x['val_acc'] for x in outputs]).mean()

          tensorboard_logs = {'val_loss': avg_loss, 'avg_val_acc': avg_val_acc}
          return {'avg_val_loss': avg_loss, 'progress_bar': tensorboard_logs}
</code></pre>
</li>
</ul>
</li>
<li>
<h4 id="統整版本">統整版本:</h4>
<pre><code>  :::python
  class PytorchLightningModel(pl.LightningModule): # 這邊一定要繼承pl.LightningModule
      def __init__(self): # 初始化時可以將基本設定傳入。
          super().__init__()
          self.ln1 = nn.Linear(768, 256)
          self.ln2 = nn.Linear(256, 3)

      def prepare_data(self): # 此方法會在初始化後優先執行。 所以可以在此方法中先將會用到的資料都讀取進來.
          self.train_set = read_data(&quot;train&quot;) # read_data是自定義的讀取資料Method. 可以按照自己需求調整
          self.test_set = read_data(&quot;test&quot;)
          self.val_set = read_data(&quot;validation&quot;)
          logging.info(&quot;===== Data is ready... =====&quot;)

      def configure_optimizer(self): # 自動訓練時會呼叫此方法來獲取Optimizer.
          return Adam(self.parameters(), lr=1e-3) # 這邊注意要調整的參數是`self.parameters()`

      # 以下三個方法則是設定進行訓練及驗證時所要使用的Data Loader格式。
      def train_dataloader(self):
          return DataLoader(self.train_set, batch_size= self.batch_size, shuffle=True) 

      def val_dataloader(self):
          return DataLoader(self.val_set, batch_size= self.batch_size, shuffle=True) 

      def test_dataloader(self):
          return DataLoader(self.test_set, batch_size= self.batch_size, shuffle=True) 

      def forward(self, x): # 定義模型在forward propagation時如何進行.
          output = self.ln1(x)
          output = self.ln2(x)
          return output

      def training_step(self, batch, batch_idx): # 定義訓練過程的Step要如何進行
          x, y = batch # 從self.train_dataloader()的Data Loader取一個batch出來。
          output = self.forward(x)
          criterion = nn.CrossEntropyLoss()
          loss = criterion(output, y)
          logs = {'loss': loss}
          return {'loss':loss, 'log':logs}

      def validation_step(self, batch, batch_idx): # 定義Validation如何進行，以這邊為例就再加上了計算Acc.
          x, y = batch
          logits = self.forward(x)
          loss = F.cross_entropy(logits, y)

          # acc
          a, y_hat = torch.max(logits, dim=1)
          val_acc = accuracy_score(y_hat.cpu(), y.cpu())
          val_acc = torch.tensor(val_acc)

          return {'val_loss': loss, 'val_acc': val_acc}

      def validation_epoch_end(self, outputs): # 在Validation的一個Epoch結束後，計算平均的Loss及Acc.
          avg_loss = torch.stack([x['val_loss'] for x in outputs]).mean()
          avg_val_acc = torch.stack([x['val_acc'] for x in outputs]).mean()

          tensorboard_logs = {'val_loss': avg_loss, 'avg_val_acc': avg_val_acc}
          return {'avg_val_loss': avg_loss, 'progress_bar': tensorboard_logs}

      def test_step(self, batch, batch_idx): #定義 Test 階段
          x, y = batch
          logits = self.forward(x)
          loss = F.cross_entropy(logits, y)

          # acc
          a, y_hat = torch.max(logits, dim=1)
          val_acc = accuracy_score(y_hat.cpu(), y.cpu())
          val_acc = torch.tensor(val_acc)

          return {'test_acc': val_acc}
</code></pre>
</li>
</ul>
<hr>
<!-- raw HTML omitted -->
<pre><code>:::python
model = PytorchLightningModel(param1=768, param2=5) # 自行封裝成Pytorch Lightning的模型

# Trainer 有不同的參數可以調整訓練時的行為
trainer = pl.Trainer() # 使用CPU
trainer = pl.Trainer(gpus=1) # 使用GPU
trainer = pl.Trainer(fast_dev_run=True) #訓練時，使用單一個batch作為ㄧ個Epoch，目的是快速的確認當前的模型設置有無結構上的問題(快速地跑完Train -&gt; Validation -&gt; Test)。

trainer.fit(model) # 呼叫.fit() 就會自動進行Model的training step及validation step.
</code></pre>
<p>原先從CPU切換為GPU，可能需要針對所有的變數、模型進行裝置的變更。<strong>但現在只需要調整Trainer的<code>gpus</code>參數即可</strong>。</p>
<p>而訓練時如果需要以dry-run的方式，確定Model從頭到尾的結構沒有問題，現在也只需要設定<code>fast_dev_run</code>即可。</p>
<p>另外Trainer Class也針對了「使用多張GPU」、「accumulate_grad_batches」提供參數進行調整，細節的部分可以參考官方網站。 <a href="https://pytorch-lightning.readthedocs.io/en/latest/trainer.html">連結在此</a></p>
<!-- raw HTML omitted -->
<pre><code>:::python
model = PytorchLightningModel(param1=768, param2=5) # 自行封裝成Pytorch Lightning的模型
trainer = Trainer(resume_from_checkpoint=&quot;PATH&quot;, gpus=1)
trainer.test(model)
</code></pre>
<hr>
<!-- raw HTML omitted -->


                

                
                <hr>
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/notes/2020/20200324/" data-toggle="tooltip" data-placement="top" title="從零開始 - Pytorch 入門懶人包">&larr;
                            Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/notes/2020/20200520/" data-toggle="tooltip" data-placement="top" title="Python 平行化運算 - Multi-Processing">Next
                            Post &rarr;</a>
                    </li>
                    
                </ul>
                

                



            </div>

            
            
            <div class="
                col-lg-2 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container">
                <div class="side-catalog">
                    <hr class="hidden-sm hidden-xs">
                    <h5>
                        <a class="catalog-toggle" href="#">CATALOG</a>
                    </h5>
                    <ul class="catalog-body"></ul>
                </div>
            </div>
            

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                
                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                        
                        
                        
                        <a href="/tags/ansible" title="ansible">
                            ansible
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/fast-api" title="fast-api">
                            fast-api
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/python" title="python">
                            python
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/test" title="test">
                            test
                        </a>
                        
                        
                        
                        <a href="/tags/tool" title="tool">
                            tool
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/wsgi" title="wsgi">
                            wsgi
                        </a>
                        
                        
                    </div>
                </section>
                

                
                
            </div>
        </div>
    </div>
</article>




<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">                  
                    
                    <li>
                        <a href="mailto:youremail@gmail.com">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		           
                    
                    
                    
                    

		            
                    
                    <li>
                        <a target="_blank" href="/your%20wechat%20qr%20code%20image">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-weixin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		            
                    
                    <li>
                        <a target="_blank" href="https://github.com/yourgithub">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		            
                    
                    
                    
                    <li>
                        <a target="_blank" href="https://www.linkedin.com/in/yourlinkedinid">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		           
                    
                    
                    <li>
                        <a target="_blank" href="https://stackoverflow.com/users/yourstackoverflowid">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-stack-overflow fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    
                    
            
            
            
           
                   <li>
                       <a href='' rel="alternate" type="application/rss+xml" title="MingLun Blog" >
                           <span class="fa-stack fa-lg">
                               <i class="fas fa-circle fa-stack-2x"></i>
                               <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
                           </span>
                       </a>
                   </li>
            
             </ul>
		<p class="copyright text-muted">
                    Copyright &copy; MingLun Blog 2023
                    <br>
                    <a href="https://themes.gohugo.io/hugo-theme-cleanwhite">CleanWhite Hugo Theme</a> by <a href="https://zhaohuabing.com">Huabing</a> |
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="100px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>




<script>
    function loadAsync(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>






<script>
    
    if($('#tag_cloud').length !== 0){
        loadAsync("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>


<script>
    loadAsync("https://cdn.jsdelivr.net/npm/fastclick@1.0.6/lib/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>






<script type="text/javascript">
    function generateCatalog(selector) {

        
        
        
        
            _containerSelector = 'div.post-container'
        

        
        var P = $(_containerSelector), a, n, t, l, i, c;
        a = P.find('h1,h2,h3,h4,h5,h6');

        
        $(selector).html('')

        
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#" + $(this).prop('id');
            t = $(this).text();
            c = $('<a href="' + i + '" rel="nofollow">' + t + '</a>');
            l = $('<li class="' + n + '_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;
    }

    generateCatalog(".catalog-body");

    
    $(".catalog-toggle").click((function (e) {
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    


    loadAsync("\/js\/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>






</body>
</html>
